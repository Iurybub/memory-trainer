<!--
  Single-file Memory Training App
  Features:
  - Generate and display a random numeric string for a configurable duration
  - User selects string length and display time; after hiding, user types recall
  - Exact-match check and per-digit accuracy with mismatch highlighting
  - Controls: Start, Show Again, Check, Next Round, Reset
  - Keyboard shortcuts: Space (Start/Show Again), Enter (Check), R (Reset), N (Next Round)
  - History of last 10 attempts with timestamp, target, answer, accuracy
  - Running stats: rounds, avg length, avg accuracy, best streak
  - Accessible: labels, focus management, ARIA live announcements
  - Responsive, minimalist UI; supports light/dark via prefers-color-scheme
  - Settings persist via localStorage
  - No external assets; inline CSS + JS only
-->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Memory Trainer — Single File</title>
<style>
  :root {
    --bg: #f7f7f8;
    --card: #ffffff;
    --text: #0f172a;
    --muted: #475569;
    --accent: #2563eb;
    --success: #16a34a;
    --warn: #d97706;
    --danger: #dc2626;
    --ring: rgba(37, 99, 235, 0.25);
    --shadow: 0 10px 20px rgba(2, 6, 23, 0.06), 0 2px 6px rgba(2, 6, 23, 0.06);
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --bg: #0b1220;
      --card: #0f172a;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #60a5fa;
      --success: #34d399;
      --warn: #fbbf24;
      --danger: #f87171;
      --ring: rgba(96, 165, 250, 0.25);
      --shadow: 0 10px 20px rgba(0,0,0,0.3), 0 2px 6px rgba(0,0,0,0.25);
    }
  }
  html, body { height: 100%; }
  body {
    margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    background: radial-gradient(1200px 800px at 80% -10%, rgba(37,99,235,.15), transparent 50%),
                radial-gradient(1000px 600px at -10% 110%, rgba(16,185,129,.12), transparent 40%),
                var(--bg);
    color: var(--text);
  }
  .container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 24px;
  }
  header {
    display: flex; align-items: center; justify-content: space-between; gap: 16px; flex-wrap: wrap;
    margin-bottom: 16px;
  }
  .title { font-size: clamp(20px, 4vw, 32px); font-weight: 700; letter-spacing: 0.2px; }
  .subtitle { color: var(--muted); font-size: 14px; }

  .grid {
    display: grid;
    grid-template-columns: 1.2fr .8fr;
    gap: 16px;
  }
  @media (max-width: 900px) {
    .grid { grid-template-columns: 1fr; }
  }

  .card {
    background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,0)) padding-box,
                var(--card) border-box;
    border: 1px solid rgba(148,163,184,0.2);
    border-radius: 18px;
    box-shadow: var(--shadow);
  }
  .card-inner { padding: 18px 18px 20px; }
  .card h2 { margin: 0 0 10px; font-size: 16px; letter-spacing: .2px; }

  .controls { display: grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 12px; }
  .form-row { display: grid; gap: 6px; }
  label { font-size: 12px; color: var(--muted); }
  input[type="number"], input[type="text"], button, select {
    appearance: none;
    border: 1px solid rgba(148,163,184,0.35);
    background: var(--card);
    color: var(--text);
    border-radius: 12px;
    padding: 10px 12px;
    font-size: 14px;
    outline: none;
    transition: box-shadow .2s ease, border-color .2s ease, transform .05s ease;
  }
  input:focus, button:focus {
    box-shadow: 0 0 0 6px var(--ring);
    border-color: var(--accent);
  }
  button { cursor: pointer; font-weight: 600; }
  .btn-row { display: flex; flex-wrap: wrap; gap: 8px; }
  .btn-primary { background: var(--accent); color: white; border-color: transparent; }
  .btn-ghost { background: transparent; }
  .btn-success { background: var(--success); color: #052e16; border-color: transparent; }
  .btn-warn { background: var(--warn); color: #3d2500; border-color: transparent; }
  .btn-danger { background: var(--danger); color: white; border-color: transparent; }
  button:active { transform: translateY(1px); }

  .display {
    position: relative;
    min-height: 160px;
    display: grid; place-items: center;
    border-radius: 14px;
    background: linear-gradient(180deg, rgba(148,163,184,0.12), transparent 50%);
    border: 1px dashed rgba(148,163,184,0.35);
    overflow: hidden;
  }
  .digits {
    font-variant-numeric: tabular-nums;
    font-weight: 800;
    letter-spacing: 0.04em;
    line-height: 1.2;
    font-size: clamp(28px, 6vw, 64px);
    opacity: 0; transform: translateY(6px);
    transition: opacity .18s ease, transform .18s ease;
    text-align: center;
    word-break: break-word;
  }
  .digits.show { opacity: 1; transform: translateY(0); }

  .status { margin-top: 10px; min-height: 24px; font-size: 14px; }
  .status.ok { color: var(--success); }
  .status.warn { color: var(--warn); }
  .status.err { color: var(--danger); }

  .answer-row { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: end; }

  .history { width: 100%; border-collapse: collapse; font-size: 13px; }
  .history th, .history td {
    padding: 8px 10px; border-bottom: 1px solid rgba(148,163,184,0.25);
    vertical-align: top;
  }
  .history th { text-align: left; color: var(--muted); font-weight: 600; }

  .badge { display: inline-block; padding: 2px 8px; border-radius: 999px; font-size: 12px; font-weight: 700; }
  .badge.ok { background: rgba(22,163,74,0.15); color: var(--success); }
  .badge.no { background: rgba(220,38,38,0.15); color: var(--danger); }

  .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  .muted { color: var(--muted); }

  .diff span { padding: 0 1px; border-radius: 3px; }
  .diff .hit { background: rgba(22,163,74,0.15); }
  .diff .miss { background: rgba(220,38,38,0.18); text-decoration: line-through; }

  .stats {
    display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 10px; margin-top: 10px;
  }
  @media (max-width: 520px) { .stats { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
  .stat {
    background: linear-gradient(180deg, rgba(148,163,184,0.12), transparent 50%);
    border: 1px solid rgba(148,163,184,0.25);
    border-radius: 12px; padding: 10px;
  }
  .stat .label { font-size: 12px; color: var(--muted); }
  .stat .value { font-size: 18px; font-weight: 800; }

  .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }
</style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <div class="title">Memory Trainer</div>
        <div class="subtitle">Digits appear for a moment—then vanish. Recall them, score yourself, get sharper.</div>
      </div>
      <div class="subtitle">Shortcuts: <span class="mono">Space</span>=Start/Show • <span class="mono">Enter</span>=Check • <span class="mono">N</span>=Next • <span class="mono">R</span>=Reset</div>
    </header>

    <main class="grid" role="main">
      <!-- Left: Play area -->
      <section class="card" aria-labelledby="play-title">
        <div class="card-inner">
          <h2 id="play-title">Play</h2>

          <form id="controls" class="controls" autocomplete="off">
<div class="form-row">
<label for="length">String length (1–50)</label>
<input id="length" name="length" type="number" inputmode="numeric" min="1" max="50" value="8" />
</div>
<div class="form-row">
<label for="ms">Display time in milliseconds (100–60000)</label>
<input id="ms" name="ms" type="number" inputmode="numeric" min="100" max="600000" step="50" value="3000" />
</div>
</form>

          <div class="btn-row" style="margin-top:8px;">
            <button id="btnStart" class="btn-primary">Start</button>
            <button id="btnShow" class="btn-ghost" disabled>Show Again</button>
            <button id="btnCheck" class="btn-success" disabled>Check</button>
            <button id="btnNext" class="btn-warn" disabled>Next Round</button>
            <button id="btnReset" class="btn-danger">Reset</button>
          </div>

          <div class="display" style="margin-top:12px;">
            <div id="digits" class="digits" aria-live="off" aria-label="Digits to memorize"></div>
          </div>

          <div id="countdown" class="muted" aria-hidden="true" style="height:20px; margin-top:6px;"></div>

          <div class="answer-row" style="margin-top:12px;">
            <div class="form-row">
              <label for="answer">Your recall</label>
              <input id="answer" name="answer" type="text" class="mono" placeholder="Type the digits here" disabled />
            </div>
            <button id="btnQuickCheck" class="btn-success">Check</button>
          </div>

          <div id="status" class="status" aria-live="polite"></div>
          <div id="sr-live" class="sr-only" aria-live="polite"></div>

          <div id="stats" class="stats" aria-label="Running statistics">
            <div class="stat"><div class="label">Rounds</div><div class="value" id="stRounds">0</div></div>
            <div class="stat"><div class="label">Avg Length</div><div class="value" id="stAvgLen">0</div></div>
            <div class="stat"><div class="label">Avg Accuracy</div><div class="value" id="stAvgAcc">0%</div></div>
            <div class="stat"><div class="label">Best Streak</div><div class="value" id="stStreak">0</div></div>
          </div>
        </div>
      </section>

      <!-- Right: History -->
      <aside class="card" aria-labelledby="hist-title">
        <div class="card-inner">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
            <h2 id="hist-title">History (last 10)</h2>
            <div class="btn-row">
              <button id="btnExport" class="btn-ghost" title="Export CSV">Export CSV</button>
              <button id="btnClearHist" class="btn-ghost" title="Clear history">Clear</button>
            </div>
          </div>
          <div class="muted" style="font-size:12px; margin-bottom:6px;">Timestamp, target vs your answer, exact, accuracy</div>
          <div style="overflow:auto; max-height:420px;">
            <table class="history" aria-describedby="hist-title">
              <thead>
                <tr><th style="width:38%">Target</th><th style="width:38%">Answer</th><th>Acc</th><th>Exact</th><th>When</th></tr>
              </thead>
              <tbody id="histBody"></tbody>
            </table>
          </div>
        </div>
      </aside>
    </main>
  </div>

<script>
(() => {
  'use strict';
  const $ = (sel) => document.querySelector(sel);
  const digitsEl = $('#digits');
  const answerEl = $('#answer');
  const statusEl = $('#status');
  const liveEl = $('#sr-live');
  const msEl = $('#ms');
  const lenEl = $('#length');
  const countdownEl = $('#countdown');
  const btnStart = $('#btnStart');
  const btnShow = $('#btnShow');
  const btnCheck = $('#btnCheck');
  const btnQuickCheck = $('#btnQuickCheck');
  const btnNext = $('#btnNext');
  const btnReset = $('#btnReset');
  const btnExport = $('#btnExport');
  const btnClearHist = $('#btnClearHist');
  const histBody = $('#histBody');
  const stRounds = $('#stRounds');
  const stAvgLen = $('#stAvgLen');
  const stAvgAcc = $('#stAvgAcc');
  const stStreak = $('#stStreak');

 const clamp = (n, min, max) => Math.min(Math.max(n, min), max);
  const nowStr = () => new Date().toLocaleString();

  const state = {
    shown: '',
    roundActive: false,
    visibleTimer: null,
    countdownTimer: null,
    lastShownAt: 0,
    history: [], // {target, answer, exact, accuracy, when}
    rounds: 0,
    sumLen: 0,
    sumAcc: 0,
    bestStreak: 0,
    currStreak: 0,
  };

  // Persistence: settings only
  const SETTINGS_KEY = 'memtrain.settings.v1';
 function loadSettings() {
try {
const raw = localStorage.getItem('memtrain.settings.v1');
if (!raw) return;
const s = JSON.parse(raw);
if (typeof s.length === 'number') lenEl.value = clamp(s.length, 1, 50);
if (typeof s.ms === 'number') msEl.value = clamp(s.ms, 100, 60000);
} catch {}
}
function saveSettings() {
const s = { length: Number(lenEl.value)||8, ms: Number(msEl.value)||3000 };
localStorage.setItem('memtrain.settings.v1', JSON.stringify(s));
}
  function saveSettings() {
const s = { length: Number(lenEl.value)||8, ms: Number(msEl.value)||3000 };
localStorage.setItem('memtrain.settings.v1', JSON.stringify(s));
}

  function generateString(len) {
    let out = '';
    for (let i=0;i<len;i++) out += Math.floor(Math.random()*10);
    return out;
  }

  function setStatus(text, klass='') {
    statusEl.textContent = text;
    statusEl.className = `status ${klass}`.trim();
  }

  function showDigits(str) {
    digitsEl.textContent = str;
    digitsEl.classList.add('show');
    digitsEl.setAttribute('aria-hidden', 'false');
  }
  function hideDigits() {
    digitsEl.classList.remove('show');
    digitsEl.setAttribute('aria-hidden', 'true');
    digitsEl.textContent = '';
  }

  function startRound(forceNew=true) {
    if (state.roundActive && !forceNew) return; // Prevent double starts

    // sanitize inputs
    const len = clamp(Number(lenEl.value)||8, 1, 50);
const ms = clamp(Number(msEl.value)||3000, 100, 60000);
    lenEl.value = len; msEl.value = ms;
    saveSettings();

    // prepare
    clearTimers();
    answerEl.value = '';
    answerEl.disabled = true;
    btnCheck.disabled = true; btnQuickCheck.disabled = true; btnNext.disabled = true; btnShow.disabled = true;
    setStatus('Get ready…', '');

    // generate & show
    state.shown = generateString(len);
    state.roundActive = true;
    state.lastShownAt = performance.now();
    showDigits(state.shown);
    btnShow.disabled = true;

    // countdown
    startCountdown(ms);

    // schedule hide
    state.visibleTimer = setTimeout(() => {
      hideDigits();
      answerEl.disabled = false;
      answerEl.focus();
      btnCheck.disabled = false; btnQuickCheck.disabled = false; btnShow.disabled = false;
      setStatus('Hidden — type your answer, then press Enter or Check.', 'warn');
      liveEl.textContent = 'String hidden — type your answer now.';
    }, ms);
  }

  function startCountdown(ms) {
    const end = performance.now() + ms;
    update();
    function update() {
      const remain = Math.max(0, end - performance.now());
      countdownEl.textContent = remain > 0 ? `Hiding in ${(remain/1000).toFixed(2)}s` : '';
      if (remain > 0) {
        state.countdownTimer = requestAnimationFrame(update);
      } else {
        countdownEl.textContent = '';
      }
    }
  }

  function clearTimers() {
    if (state.visibleTimer) { clearTimeout(state.visibleTimer); state.visibleTimer = null; }
    if (state.countdownTimer) { cancelAnimationFrame(state.countdownTimer); state.countdownTimer = null; }
  }

  function showAgain() {
    if (!state.roundActive || !state.shown) return;
    const ms = clamp(Number(msEl.value)||3000, 100, 10000);
    clearTimers();
    showDigits(state.shown);
    answerEl.blur();
    btnCheck.disabled = true; btnQuickCheck.disabled = true; btnShow.disabled = true;
    setStatus('Showing again…', '');
    startCountdown(ms);
    state.visibleTimer = setTimeout(() => {
      hideDigits();
      btnCheck.disabled = false; btnQuickCheck.disabled = false; btnShow.disabled = false;
      answerEl.focus();
      setStatus('Hidden — type your answer, then press Enter or Check.', 'warn');
      liveEl.textContent = 'String hidden — type your answer now.';
    }, ms);
  }

  function scoreAttempt(target, answer) {
    const L = Math.max(target.length, answer.length);
    let hits = 0;
    const spansT = [];
    const spansA = [];
    for (let i=0;i<L;i++) {
      const t = target[i] ?? '';
      const a = answer[i] ?? '';
      const ok = t === a && t !== '';
      if (ok) hits++;
      spansT.push(`<span class="${ok? 'hit':'miss'}">${t || '·'}</span>`);
      spansA.push(`<span class="${ok? 'hit':'miss'}">${a || '·'}</span>`);
    }
    const accuracy = L ? Math.round((hits / L) * 100) : 0;
    const exact = target === answer && target.length>0;
    return { accuracy, exact, markT: spansT.join(''), markA: spansA.join('') };
  }

  function check() {
    if (!state.roundActive || !state.shown) { setStatus('Start a round first.', 'err'); return; }
    const ans = (answerEl.value || '').trim();
    const { accuracy, exact, markT, markA } = scoreAttempt(state.shown, ans);

    // Update history
    const entry = { target: state.shown, answer: ans, exact, accuracy, when: nowStr() };
    state.history.unshift(entry);
    if (state.history.length > 10) state.history.pop();

    // Update stats
    state.rounds++;
    state.sumLen += state.shown.length;
    state.sumAcc += accuracy;
    if (exact) { state.currStreak++; state.bestStreak = Math.max(state.bestStreak, state.currStreak); }
    else { state.currStreak = 0; }

    renderHistory();
    renderStats();

    // Show feedback
    const badge = exact ? '<span class="badge ok">Exact</span>' : '<span class="badge no">Mismatch</span>';
    setStatus(`${badge} Accuracy: ${accuracy}%`, exact ? 'ok' : 'err');

    // Render pretty diff below inputs
    const diffHtml = `
      <div class="diff" style="margin-top:8px;">
        <div class="muted" style="font-size:12px; margin-bottom:3px;">Target</div>
        <div class="mono" aria-label="target diff visualization">${markT}</div>
        <div class="muted" style="font-size:12px; margin-top:6px; margin-bottom:3px;">Your answer</div>
        <div class="mono" aria-label="answer diff visualization">${markA}</div>
      </div>`;

    // Replace digits area with diff for rapid learning; keep the raw digits hidden to not give away instantly.
    digitsEl.innerHTML = diffHtml;
    digitsEl.classList.add('show');

    // Buttons state
    btnNext.disabled = false; btnShow.disabled = false; btnCheck.disabled = true; btnQuickCheck.disabled = true;
    answerEl.blur();
  }

  function nextRound() {
    startRound(true);
  }

  function resetAll() {
    clearTimers();
    state.shown=''; state.roundActive=false; state.history=[]; state.rounds=0; state.sumLen=0; state.sumAcc=0; state.currStreak=0; state.bestStreak=0;
    hideDigits();
    answerEl.value=''; answerEl.disabled=true;
    btnCheck.disabled=true; btnQuickCheck.disabled=false; btnNext.disabled=true; btnShow.disabled=true;
    countdownEl.textContent='';
    setStatus('Reset complete. Configure settings and press Start.','');
    renderHistory();
    renderStats();
  }

  function renderHistory() {
    if (!state.history.length) { histBody.innerHTML = '<tr><td colspan="5" class="muted">No attempts yet.</td></tr>'; return; }
    histBody.innerHTML = state.history.map(h => `
      <tr>
        <td class="mono">${h.target}</td>
        <td class="mono">${h.answer || '<span class=\'muted\'>(empty)</span>'}</td>
        <td>${h.accuracy}%</td>
        <td>${h.exact ? '<span class="badge ok">Yes</span>' : '<span class="badge no">No</span>'}</td>
        <td class="muted">${h.when}</td>
      </tr>`).join('');
  }

  function renderStats() {
    stRounds.textContent = state.rounds;
    stAvgLen.textContent = state.rounds ? Math.round((state.sumLen/state.rounds)*10)/10 : 0;
    stAvgAcc.textContent = state.rounds ? `${Math.round(state.sumAcc/state.rounds)}%` : '0%';
    stStreak.textContent = state.bestStreak;
  }

  function exportCSV() {
    if (!state.history.length) { setStatus('Nothing to export yet.', 'warn'); return; }
    const rows = [
      ['timestamp','target','answer','accuracy','exact'],
      ...state.history.map(h => [h.when, h.target, h.answer, h.accuracy, h.exact])
    ];
    const csv = rows.map(r => r.map(cell => {
      const s = String(cell ?? '');
      return /[",\n]/.test(s) ? '"' + s.replace(/"/g,'""') + '"' : s;
    }).join(',')).join('\n');
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = `memory-history-${Date.now()}.csv`;
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
    setStatus('Exported CSV of your last attempts.', 'ok');
  }

  // Event wiring
  btnStart.addEventListener('click', () => startRound(true));
  btnShow.addEventListener('click', showAgain);
  btnCheck.addEventListener('click', check);
  btnQuickCheck.addEventListener('click', (e)=>{ e.preventDefault(); check(); });
  btnNext.addEventListener('click', nextRound);
  btnReset.addEventListener('click', resetAll);
  btnExport.addEventListener('click', exportCSV);
  btnClearHist.addEventListener('click', () => { state.history = []; renderHistory(); setStatus('History cleared.', ''); });

  // Form validation and persistence
  [lenEl, msEl].forEach(el => el.addEventListener('change', () => {
    el.value = el === lenEl ? clamp(Number(el.value)||8, 1, 50) : clamp(Number(el.value)||3000, 100, 10000);
    saveSettings();
  }));

  // Keyboard shortcuts
  window.addEventListener('keydown', (e) => {
    if (e.target && (e.target.tagName === 'INPUT' || e.target.isContentEditable)) {
      if (e.key === 'Enter') { e.preventDefault(); check(); }
      return; // don't hijack other keys while typing
    }
    if (e.code === 'Space') { e.preventDefault(); (btnShow.disabled ? startRound(true) : showAgain()); }
    else if (e.key.toLowerCase() === 'n') { e.preventDefault(); nextRound(); }
    else if (e.key.toLowerCase() === 'r') { e.preventDefault(); resetAll(); }
  });

  // Init
  loadSettings();
  renderHistory();
  renderStats();
  setStatus('Configure settings and press Start.','');
})();
</script>
</body>
</html>
